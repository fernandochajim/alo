<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Interactivo de Morfolog√≠a</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .quiz-container {
            min-height: 450px;
            display: flex;
            flex-direction: column;
        }
        .option-label {
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }
        .option-label.selected {
            background-color: #e0e7ff; /* indigo-100 */
            border-color: #6366f1; /* indigo-500 */
        }
        .correct-answer-label {
            background-color: #dcfce7 !important; /* green-100 */
            border-color: #22c55e !important; /* green-500 */
            color: #15803d; /* green-700 */
        }
        .incorrect-answer-label {
            background-color: #fee2e2 !important; /* red-100 */
            border-color: #ef4444 !important; /* red-500 */
            color: #b91c1c; /* red-700 */
        }
        .explanation {
            border-left-width: 4px;
            padding-left: 1rem;
            margin-top: 1rem;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .explanation.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .progress-bar-fill {
            transition: width 0.4s ease-in-out;
        }
        /* Fade transition for question change */
        .question-fade-exit {
            opacity: 0;
            transition: opacity 0.2s ease-in;
        }
        .question-fade-enter {
            opacity: 1;
            transition: opacity 0.2s ease-out;
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto max-w-lg p-4 min-h-screen flex flex-col justify-center">

        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-3xl sm:text-4xl font-bold text-indigo-600">Examen de Morfolog√≠a ü©∫‚ù§Ô∏è</h1>
            <p class="mt-2 text-slate-500">¬°Demuestra cu√°nto sabes, mi amor!</p>
        </header>

        <!-- Quiz Area -->
        <div id="quiz-area" class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl w-full">
            
            <!-- Progress Bar -->
            <div id="progress-container" class="mb-4">
                <div class="flex justify-between items-center mb-1 text-sm text-slate-500">
                    <span>Progreso</span>
                    <span id="progress-text">Pregunta 1/50</span>
                </div>
                <div class="w-full bg-slate-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-indigo-500 h-2.5 rounded-full progress-bar-fill" style="width: 2%"></div>
                </div>
            </div>

            <div class="quiz-container">
                <!-- Question Content -->
                <div id="question-content" class="flex-grow">
                    <p id="question-text" class="text-lg font-semibold mb-4 min-h-[60px]"></p>
                    <div id="options-container" class="space-y-3"></div>
                </div>
    
                <!-- Explanation Area -->
                <div id="explanation-box" class="explanation p-4 rounded-lg bg-slate-50 text-slate-700 hidden"></div>
    
                <!-- Navigation -->
                <div class="flex justify-between items-center mt-6 pt-4 border-t border-slate-200">
                    <button id="prev-btn" class="py-2 px-5 bg-slate-200 text-slate-700 font-semibold rounded-full hover:bg-slate-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">Anterior</button>
                    <button id="check-btn" class="py-2 px-5 bg-indigo-500 text-white font-semibold rounded-full hover:bg-indigo-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">Revisar</button>
                    <button id="next-btn" class="py-2 px-5 bg-indigo-500 text-white font-semibold rounded-full hover:bg-indigo-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed hidden">Siguiente</button>
                </div>
            </div>
        </div>
        
        <!-- Results Section (Initially Hidden) -->
        <div id="results-container" class="hidden text-center bg-white p-8 rounded-2xl shadow-xl">
             <h2 class="text-3xl font-bold text-indigo-600 mb-4">¬°Resultados Finales!</h2>
            <div class="text-center text-lg">
                <p>Respuestas Correctas: <span id="score" class="font-bold text-green-600">0</span> de <span id="total-questions" class="font-bold">0</span></p>
                <p class="text-5xl font-bold my-4" id="percentage">0%</p>
                <p class="mt-4 text-slate-600 text-base" id="final-message"></p>
            </div>
        </div>

    </div>

    <script>
        const questions = [
            // RAMAS DE LA MORFOLOG√çA
            { q: "¬øQu√© rama de la morfolog√≠a estudia el desarrollo prenatal?", o: ["Histolog√≠a", "Embriolog√≠a", "Anatom√≠a Patol√≥gica", "Citolog√≠a"], a: "Embriolog√≠a", e: "La Embriolog√≠a se especializa en el estudio de todo el desarrollo antes del nacimiento." },
            { q: "¬øCu√°l es el objeto de estudio de la Histolog√≠a?", o: ["Las c√©lulas", "Los √≥rganos", "Los tejidos a nivel microsc√≥pico", "Las enfermedades"], a: "Los tejidos a nivel microsc√≥pico", e: "La Histolog√≠a es el estudio microsc√≥pico de la estructura y funci√≥n de los tejidos." },
            { q: "La ciencia que estudia la estructura del cuerpo humano es la:", o: ["Fisiolog√≠a", "Anatom√≠a", "Embriolog√≠a", "Patolog√≠a"], a: "Anatom√≠a", e: "La Anatom√≠a es la ciencia fundamental que estudia la forma y estructura del cuerpo." },
            
            // PLANIMETR√çA Y EJES
            { q: "Un plano que divide el cuerpo en una parte anterior y otra posterior se llama:", o: ["Plano Sagital", "Plano Transversal", "Plano Coronal o Frontal", "Plano Oblicuo"], a: "Plano Coronal o Frontal", e: "El plano Coronal o Frontal realiza un corte vertical que separa el cuerpo en anterior (ventral) y posterior (dorsal)." },
            { q: "El plano Sagital divide el cuerpo en:", o: ["Parte superior e inferior", "Parte anterior y posterior", "Parte derecha e izquierda", "Partes desiguales"], a: "Parte derecha e izquierda", e: "El plano Sagital es un corte vertical que divide el cuerpo en una mitad derecha y otra izquierda." },
            { q: "¬øQu√© plano usar√≠as para dividir el cuerpo en una secci√≥n craneal y otra caudal?", o: ["Plano Sagital", "Plano Transversal", "Plano Frontal", "Eje Longitudinal"], a: "Plano Transversal", e: "El plano Transversal realiza un corte horizontal, separando el cuerpo en una parte superior (craneal) y otra inferior (caudal)." },
            { q: "El eje Cefalocaudal tambi√©n es conocido como:", o: ["Anteroposterior", "Transversal", "Longitudinal", "Horizontal"], a: "Longitudinal", e: "El eje Cefalocaudal o Longitudinal recorre el cuerpo de arriba hacia abajo." },
            
            // T√âRMINOS DE POSICI√ìN
            { q: "El t√©rmino 'Proximal' describe una estructura que est√°:", o: ["M√°s cerca de la l√≠nea media", "M√°s alejada del tronco", "M√°s cerca del tronco o punto de origen", "En la superficie del cuerpo"], a: "M√°s cerca del tronco o punto de origen", e: "'Proximal' indica cercan√≠a al punto de origen de una extremidad o al tronco." },
            { q: "¬øCu√°l es el t√©rmino opuesto a 'Superior' o 'Craneal'?", o: ["Ventral", "Dorsal", "Lateral", "Inferior o Caudal"], a: "Inferior o Caudal", e: "'Inferior' o 'caudal' se refiere a una estructura que est√° m√°s abajo o m√°s cerca de los pies." },
            { q: "Si una estructura est√° m√°s cerca de la l√≠nea media del cuerpo, se dice que es:", o: ["Lateral", "Distal", "Medial", "Proximal"], a: "Medial", e: "'Medial' se refiere a lo que est√° m√°s cerca del plano sagital medio del cuerpo." },
            
            // POSICI√ìN ANAT√ìMICA
            { q: "¬øC√≥mo deben estar las palmas de las manos en la posici√≥n anat√≥mica?", o: ["Mirando hacia atr√°s", "Mirando hacia los lados", "Mirando hacia adelante", "Apoyadas en los muslos"], a: "Mirando hacia adelante", e: "En la posici√≥n anat√≥mica de referencia, las palmas de las manos se dirigen hacia el frente (posici√≥n de supinaci√≥n)." },

            // CAVIDADES CORPORALES
            { q: "¬øEn qu√© cavidad se encuentra el coraz√≥n?", o: ["Cavidad Pleural", "Cavidad Peric√°rdica", "Canal Vertebral", "Cavidad Abdominal"], a: "Cavidad Peric√°rdica", e: "El coraz√≥n est√° alojado en la cavidad Peric√°rdica, que se encuentra en el mediastino dentro de la cavidad tor√°cica." },
            { q: "La cavidad craneal y el canal vertebral juntos forman la:", o: ["Cavidad Ventral", "Cavidad Abdominop√©lvica", "Cavidad Tor√°cica", "Cavidad Dorsal"], a: "Cavidad Dorsal", e: "La Cavidad Dorsal protege el sistema nervioso central y se divide en la cavidad craneal y el canal vertebral." },
            { q: "El Mediastino es una subdivisi√≥n de la cavidad:", o: ["Craneal", "P√©lvica", "Tor√°cica", "Abdominal"], a: "Tor√°cica", e: "El mediastino es el espacio central de la cavidad tor√°cica, entre las cavidades pleurales, que contiene al coraz√≥n, grandes vasos, etc." },
            
            // DIVISI√ìN CORPORAL
            { q: "El t√≥rax, el abdomen y la pelvis son subdivisiones del:", o: ["Miembro Superior", "Tronco", "Miembro Inferior", "Cuello"], a: "Tronco", e: "El tronco es la parte central del cuerpo que se divide en t√≥rax, abdomen y pelvis." },
            { q: "El antebrazo se encuentra entre:", o: ["El hombro y el brazo", "El brazo y la mano", "La mu√±eca y los dedos", "La cadera y el muslo"], a: "El brazo y la mano", e: "El miembro superior se divide en brazo (hombro a codo), antebrazo (codo a mu√±eca) y mano." },
            
            // NIVELES DE ORGANIZACI√ìN
            { q: "En la jerarqu√≠a de organizaci√≥n, ¬øqu√© nivel se encuentra entre el nivel celular y el nivel de √≥rganos?", o: ["Nivel Qu√≠mico", "Nivel Tisular", "Nivel de Sistemas", "Nivel de Organismo"], a: "Nivel Tisular", e: "Las c√©lulas se agrupan para formar tejidos (nivel tisular), y los tejidos se agrupan para formar √≥rganos." },
            { q: "El nivel m√°s complejo de organizaci√≥n biol√≥gica es el:", o: ["Nivel Celular", "Nivel de √ìrganos", "Nivel de Aparatos y Sistemas", "Nivel de Organismo"], a: "Nivel de Organismo", e: "El organismo representa el conjunto de todos los sistemas funcionando de manera coordinada, constituyendo el nivel m√°s alto de organizaci√≥n." },

            // SISTEMAS CORPORALES
            { q: "¬øQu√© sistema es responsable de la producci√≥n de hormonas?", o: ["Sistema Nervioso", "Sistema Endocrino", "Sistema Linf√°tico", "Sistema Urinario"], a: "Sistema Endocrino", e: "El sistema Endocrino regula procesos corporales a trav√©s de la producci√≥n y secreci√≥n de hormonas." },
            { q: "La piel y sus anexos (pelo, u√±as) forman el sistema:", o: ["Esquel√©tico", "Muscular", "Tegumentario", "Cardiovascular"], a: "Tegumentario", e: "El sistema Tegumentario es el sistema de cobertura del cuerpo, compuesto por la piel y sus faneras." },
            
            // RAMAS DE LA ANATOM√çA
            { q: "La anatom√≠a que estudia el cuerpo mediante t√©cnicas de imagen como Rayos X o TC es la:", o: ["Anatom√≠a Cl√≠nica", "Anatom√≠a de Superficie", "Anatom√≠a Radiol√≥gica", "Anatom√≠a Microsc√≥pica"], a: "Anatom√≠a Radiol√≥gica", e: "Esta rama se especializa en el estudio del cuerpo vivo a trav√©s de im√°genes diagn√≥sticas." },
            { q: "Si se compara la anatom√≠a de un humano con la de un primate, se est√° aplicando la:", o: ["Anatom√≠a del Desarrollo", "Anatom√≠a Patol√≥gica", "Anatom√≠a Regional", "Anatom√≠a Comparada"], a: "Anatom√≠a Comparada", e: "La Anatom√≠a Comparada estudia y compara las estructuras de diferentes especies para entender sus similitudes y diferencias evolutivas." },
            { q: "¬øQu√© incluye la Anatom√≠a Microsc√≥pica?", o: ["Citolog√≠a e Histolog√≠a", "Embriolog√≠a y Radiolog√≠a", "Sist√©mica y Regional", "Cl√≠nica y Aplicada"], a: "Citolog√≠a e Histolog√≠a", e: "Requiere el uso de un microscopio e incluye el estudio de las c√©lulas (Citolog√≠a) y los tejidos (Histolog√≠a)." },
            
            // IMAGENOLOG√çA
            { q: "¬øQu√© t√©cnica de imagen utiliza un campo magn√©tico potente y ondas de radio?", o: ["Tomograf√≠a Computarizada (TC)", "Ultrasonograf√≠a", "Resonancia Magn√©tica (RM)", "Radiolog√≠a Convencional"], a: "Resonancia Magn√©tica (RM)", e: "La RM es ideal para ver tejidos blandos y no utiliza radiaci√≥n ionizante, bas√°ndose en campos magn√©ticos y ondas de radio." },
            { q: "En una radiograf√≠a, una estructura que se ve oscura (negra) se denomina:", o: ["Radiopaca", "Radiol√∫cida", "Ecorefringente", "Hipointensa"], a: "Radiol√∫cida", e: "Las estructuras menos densas, como el aire en los pulmones, permiten el paso de los Rayos X y se ven oscuras o radiol√∫cidas." },
            { q: "¬øCu√°l de estas t√©cnicas de imagen NO utiliza radiaci√≥n ionizante?", o: ["Radiolog√≠a Convencional", "Tomograf√≠a Computarizada (TC)", "Medicina Nuclear", "Ultrasonograf√≠a (Ecograf√≠a)"], a: "Ultrasonograf√≠a (Ecograf√≠a)", e: "La ecograf√≠a utiliza ondas de sonido de alta frecuencia, por lo que es segura y no implica exposici√≥n a radiaci√≥n ionizante." },
            { q: "La Tomograf√≠a por Emisi√≥n de Positrones (PET) es √∫nica porque muestra:", o: ["La densidad de los huesos", "La estructura de los √≥rganos", "La actividad metab√≥lica de las c√©lulas", "El flujo sangu√≠neo en tiempo real"], a: "La actividad metab√≥lica de las c√©lulas", e: "El PET es una t√©cnica de medicina nuclear que eval√∫a la funci√≥n de los tejidos midiendo su actividad metab√≥lica." },
            
            // PIEL Y FANERAS
            { q: "¬øCu√°l es la capa m√°s profunda de la piel?", o: ["Epidermis", "Dermis", "Hipodermis", "Fascia Profunda"], a: "Hipodermis", e: "La Hipodermis (o tejido subcut√°neo) es la capa m√°s profunda, compuesta principalmente por tejido adiposo." },
            { q: "Los queratinocitos, melanocitos y c√©lulas de Langerhans se encuentran en la:", o: ["Dermis", "Hipodermis", "Epidermis", "Fascia Superficial"], a: "Epidermis", e: "Estas c√©lulas son componentes clave de la Epidermis, la capa m√°s externa de la piel." },
            { q: "El estrato m√°s superficial de la epidermis, compuesto por c√©lulas muertas, es el:", o: ["Estrato Basal", "Estrato Espinoso", "Estrato C√≥rneo", "Estrato Granuloso"], a: "Estrato C√≥rneo", e: "El estrato c√≥rneo es la capa m√°s externa y protectora de la epidermis." },
            { q: "La dermis se divide en dos capas:", o: ["Papilar y Reticular", "Basal y Espinoso", "Superficial y Profunda", "Externa e Interna"], a: "Papilar y Reticular", e: "La dermis tiene una capa superficial (Papilar) y una m√°s profunda y gruesa (Reticular)." },
            { q: "Los vasos sangu√≠neos, nervios y fol√≠culos pilosos se alojan principalmente en la:", o: ["Epidermis", "Dermis", "Hipodermis", "Estrato C√≥rneo"], a: "Dermis", e: "La Dermis es la capa que contiene la mayor√≠a de las estructuras de soporte y anexos de la piel." },
            { q: "El pelo y las u√±as son conocidos como:", o: ["Gl√°ndulas", "Faneras", "Fascias", "Tejidos"], a: "Faneras", e: "Las faneras o anexos cut√°neos son estructuras derivadas de la piel, como pelos, u√±as y gl√°ndulas." },
            { q: "Las gl√°ndulas sudor√≠paras que ayudan a la termorregulaci√≥n son principalmente las:", o: ["Apocrinas", "Ecrinas", "Seb√°ceas", "Mamarias"], a: "Ecrinas", e: "Las gl√°ndulas ecrinas se distribuyen por todo el cuerpo y su principal funci√≥n es producir sudor para enfriar el cuerpo." },
            { q: "El sebo es una sustancia oleosa producida por las gl√°ndulas:", o: ["Sudor√≠paras", "Apocrinas", "Mamarias", "Seb√°ceas"], a: "Seb√°ceas", e: "Las gl√°ndulas seb√°ceas secretan sebo para lubricar la piel y el pelo." },

            // FASCIAS
            { q: "¬øQu√© tipo de fascia se encuentra en la hipodermis y contiene grasa?", o: ["Fascia Profunda", "Fascia Visceral", "Fascia Superficial", "Fascia Muscular"], a: "Fascia Superficial", e: "La Fascia Superficial est√° directamente debajo de la dermis, en el tejido subcut√°neo, y contiene grasa, nervios y vasos superficiales." },
            { q: "La envoltura de tejido conectivo denso que rodea los m√∫sculos se llama:", o: ["Fascia Superficial", "Fascia Profunda", "Fascia Subserosa", "Epidermis"], a: "Fascia Profunda", e: "La Fascia Profunda es la que no contiene grasa y se organiza para envolver y compartimentar los m√∫sculos." },

            // FUNCIONES DE LA PIEL
            { q: "La s√≠ntesis de Vitamina D en la piel se activa por la exposici√≥n a:", o: ["El calor", "La luz solar (radiaci√≥n UV)", "La humedad", "El fr√≠o"], a: "La luz solar (radiaci√≥n UV)", e: "La piel juega un papel crucial en la producci√≥n de Vitamina D cuando se expone a la radiaci√≥n ultravioleta del sol." },
            { q: "¬øC√≥mo contribuye la piel a la termorregulaci√≥n cuando hace calor?", o: ["Contrayendo los vasos sangu√≠neos", "Produciendo m√°s queratina", "Mediante la sudoraci√≥n y vasodilataci√≥n", "Aumentando el grosor de la hipodermis"], a: "Mediante la sudoraci√≥n y vasodilataci√≥n", e: "Para perder calor, la piel aumenta el flujo sangu√≠neo a la superficie (vasodilataci√≥n) y produce sudor, que al evaporarse enfr√≠a el cuerpo." },
            // Additional questions to reach 50+
            { q: "¬øQu√© estudia la Anatom√≠a Patol√≥gica?", o: ["El desarrollo prenatal", "La estructura normal del cuerpo", "Las alteraciones morfol√≥gicas por enfermedades", "Las estructuras bajo el microscopio"], a: "Las alteraciones morfol√≥gicas por enfermedades", e: "La Anatom√≠a Patol√≥gica se enfoca en c√≥mo las enfermedades alteran la estructura de los tejidos y √≥rganos." },
            { q: "El eje que atraviesa el cuerpo de adelante hacia atr√°s es el:", o: ["Longitudinal", "Cefalocaudal", "Transversal", "Anteroposterior"], a: "Anteroposterior", e: "El eje Anteroposterior (o sagital) va desde la parte anterior (ventral) a la posterior (dorsal)." },
            { q: "El t√©rmino 'Ventral' es sin√≥nimo de:", o: ["Superior", "Posterior", "Anterior", "Inferior"], a: "Anterior", e: "'Ventral' se refiere a la parte frontal o del vientre del cuerpo, siendo sin√≥nimo de 'Anterior'." },
            { q: "Las cavidades pleurales, que contienen los pulmones, se encuentran dentro de la:", o: ["Cavidad Dorsal", "Cavidad Tor√°cica", "Cavidad Abdominal", "Cavidad P√©lvica"], a: "Cavidad Tor√°cica", e: "La Cavidad Tor√°cica alberga las dos cavidades pleurales (para los pulmones) y el mediastino." },
            { q: "El nivel de organizaci√≥n que precede al Nivel Celular es el:", o: ["Nivel Tisular", "Nivel de Organismo", "Nivel Qu√≠mico", "Nivel de √ìrganos"], a: "Nivel Qu√≠mico", e: "El Nivel Qu√≠mico (√°tomos y mol√©culas) es el m√°s b√°sico, y sus componentes se unen para formar c√©lulas." },
            { q: "El sistema que se encarga de la defensa del cuerpo contra pat√≥genos es el:", o: ["Cardiovascular", "Respiratorio", "Digestivo", "Linf√°tico"], a: "Linf√°tico", e: "El Sistema Linf√°tico es una parte clave del sistema inmunitario, defendiendo al cuerpo de infecciones." },
            { q: "El estudio de las estructuras que se pueden ver o palpar bajo la piel corresponde a la:", o: ["Anatom√≠a Regional", "Anatom√≠a de Superficie", "Anatom√≠a del Desarrollo", "Anatom√≠a Sist√©mica"], a: "Anatom√≠a de Superficie", e: "La Anatom√≠a de Superficie relaciona las estructuras internas con los relieves y marcas visibles en la superficie corporal." },
            { q: "Las c√©lulas de Merkel en la epidermis est√°n asociadas con la funci√≥n de:", o: ["Pigmentaci√≥n", "Defensa inmune", "Producci√≥n de queratina", "Sensaci√≥n t√°ctil"], a: "Sensaci√≥n t√°ctil", e: "Las c√©lulas de Merkel son receptores sensoriales que participan en la detecci√≥n del tacto." },
            { q: "La dermis reticular, la capa m√°s profunda de la dermis, est√° compuesta principalmente por tejido:", o: ["Adiposo", "Nervioso", "Conectivo denso irregular", "Epitelial"], a: "Conectivo denso irregular", e: "Esta capa proporciona resistencia y elasticidad a la piel gracias a sus fibras de col√°geno y elastina." },
            { q: "El m√∫sculo erector del pelo tiene como funci√≥n:", o: ["Lubricar el pelo", "Producir queratina", "Hacer que el pelo se erice ('piel de gallina')", "Dar color al pelo"], a: "Hacer que el pelo se erice ('piel de gallina')", e: "Este peque√±o m√∫sculo liso se contrae en respuesta al fr√≠o o al miedo, haciendo que el pelo se levante." },
            { q: "La Fascia Visceral tambi√©n se conoce como:", o: ["Fascia Profunda", "Fascia Superficial", "Fascia Subserosa", "Hipodermis"], a: "Fascia Subserosa", e: "Se encuentra entre la fascia muscular interna y las membranas serosas que recubren las cavidades corporales." }
        ];

        // Shuffle questions
        questions.sort(() => Math.random() - 0.5);

        let currentQuestionIndex = 0;
        const userAnswers = new Array(questions.length).fill(null);

        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const explanationBox = document.getElementById('explanation-box');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const checkBtn = document.getElementById('check-btn');
        const quizArea = document.getElementById('quiz-area');
        const resultsContainer = document.getElementById('results-container');
        
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');

        function renderQuestion() {
            const questionContent = document.getElementById('question-content');
            questionContent.classList.add('question-fade-exit');

            setTimeout(() => {
                const question = questions[currentQuestionIndex];
                questionText.textContent = question.q;
                optionsContainer.innerHTML = '';
                explanationBox.classList.add('hidden');
                explanationBox.classList.remove('visible');

                // Shuffle options for each question
                const shuffledOptions = [...question.o].sort(() => Math.random() - 0.5);

                shuffledOptions.forEach(option => {
                    const label = document.createElement('label');
                    label.className = 'option-label block p-4 my-2 rounded-lg border-2 border-slate-200 cursor-pointer hover:bg-slate-100';
                    label.innerHTML = `
                        <input type="radio" name="option" value="${option}" class="mr-3 accent-indigo-500">
                        ${option}
                    `;
                    optionsContainer.appendChild(label);

                    // Add click listener to update selected style
                    label.addEventListener('click', () => {
                        document.querySelectorAll('.option-label').forEach(l => l.classList.remove('selected'));
                        label.classList.add('selected');
                        checkBtn.disabled = false;
                    });
                });

                updateProgress();
                updateNavButtons();
                restoreAnswerState();
                
                questionContent.classList.remove('question-fade-exit');
                questionContent.classList.add('question-fade-enter');
            }, 200);
        }

        function updateProgress() {
            const progressPercentage = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBar.style.width = `${progressPercentage}%`;
            progressText.textContent = `Pregunta ${currentQuestionIndex + 1}/${questions.length}`;
        }

        function updateNavButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = currentQuestionIndex === questions.length - 1 && userAnswers[currentQuestionIndex] === null;
            
            checkBtn.classList.remove('hidden');
            nextBtn.classList.add('hidden');
            checkBtn.disabled = true; // Disabled until an option is selected

            if (userAnswers[currentQuestionIndex] !== null) {
                checkBtn.classList.add('hidden');
                nextBtn.classList.remove('hidden');
            }
            
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.textContent = "Ver Resultados";
            } else {
                 nextBtn.textContent = "Siguiente";
            }
        }
        
        function restoreAnswerState() {
            const answerState = userAnswers[currentQuestionIndex];
            if (answerState) {
                const radios = document.querySelectorAll('input[name="option"]');
                radios.forEach(radio => {
                    radio.disabled = true;
                    const parentLabel = radio.parentElement;
                    if (radio.value === questions[currentQuestionIndex].a) {
                        parentLabel.classList.add('correct-answer-label');
                    }
                    if (radio.value === answerState.selected && !answerState.isCorrect) {
                        parentLabel.classList.add('incorrect-answer-label');
                    }
                });
                showExplanation(answerState.isCorrect);
            }
        }
        
        function showExplanation(isCorrect) {
            const question = questions[currentQuestionIndex];
            explanationBox.classList.remove('hidden');
            
            if (isCorrect) {
                explanationBox.innerHTML = `<strong class="text-green-700">¬°Correcto!</strong> ${question.e}`;
                explanationBox.className = 'explanation p-4 rounded-lg bg-green-50 text-green-800 border-green-400 visible';
            } else {
                explanationBox.innerHTML = `<strong class="text-red-700">Incorrecto.</strong> La respuesta correcta es <strong>"${question.a}"</strong>. <br>${question.e}`;
                explanationBox.className = 'explanation p-4 rounded-lg bg-red-50 text-red-800 border-red-400 visible';
            }
        }

        checkBtn.addEventListener('click', () => {
            const selectedRadio = document.querySelector('input[name="option"]:checked');
            if (!selectedRadio) return;

            const userAnswer = selectedRadio.value;
            const question = questions[currentQuestionIndex];
            const isCorrect = userAnswer === question.a;
            
            userAnswers[currentQuestionIndex] = { selected: userAnswer, isCorrect: isCorrect };

            const radios = document.querySelectorAll('input[name="option"]');
            radios.forEach(radio => {
                radio.disabled = true;
                const parentLabel = radio.parentElement;
                if (radio.value === question.a) {
                    parentLabel.classList.add('correct-answer-label');
                }
                 if (radio.checked && !isCorrect) {
                    parentLabel.classList.add('incorrect-answer-label');
                }
            });
            
            showExplanation(isCorrect);
            checkBtn.classList.add('hidden');
            nextBtn.classList.remove('hidden');
        });

        nextBtn.addEventListener('click', () => {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            } else {
                showResults();
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        });
        
        function showResults() {
            const score = userAnswers.filter(answer => answer && answer.isCorrect).length;
            const total = questions.length;
            const percentage = Math.round((score / total) * 100);

            quizArea.classList.add('hidden');
            resultsContainer.classList.remove('hidden');

            document.getElementById('score').textContent = score;
            document.getElementById('total-questions').textContent = total;
            const percentageEl = document.getElementById('percentage');
            const finalMessageEl = document.getElementById('final-message');
            
            percentageEl.textContent = `${percentage}%`;

            if (percentage === 100) {
                finalMessageEl.innerHTML = "¬°Felicidades, mi vida! ¬°Eres incre√≠blemente inteligente! üíñ Eres una experta total.";
                percentageEl.className = "text-5xl font-bold my-4 text-green-500";
            } else if (percentage >= 80) {
                finalMessageEl.textContent = "¬°Wow! ¬°Casi perfecto! Estoy muy orgulloso de ti. Eres brillante. ‚ú®";
                percentageEl.className = "text-5xl font-bold my-4 text-cyan-500";
            } else if (percentage >= 60) {
                finalMessageEl.textContent = "¬°Muy bien hecho! Sabes much√≠simo. ¬°Sigue as√≠, vas por un gran camino! üòä";
                percentageEl.className = "text-5xl font-bold my-4 text-indigo-500";
            } else {
                finalMessageEl.textContent = "¬°Buen intento! Lo importante es aprender juntos. ¬°Eres genial por esforzarte! üí™";
                percentageEl.className = "text-5xl font-bold my-4 text-amber-500";
            }
        }

        // Initial load
        renderQuestion();
    </script>
</body>
</html>

